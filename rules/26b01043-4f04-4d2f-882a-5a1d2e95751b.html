<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Home</title><meta name="next-head-count" content="3"/><meta name="description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:title" content="Elastic UI"/><meta property="og:description" content="Detection Rules is the home for rules used by Elastic Security."/><meta property="og:image" content="https://repository-images.githubusercontent.com/233832487/cddf0ff5-a35f-4380-8912-1c9f365366a8"/><meta property="og:url" content="https://elastic.github.io/next-eui-starter/"/><meta name="twitter:card" content="summary_large_image"/><meta name="eui-styles"/><link rel="stylesheet" href="/detection-rules/themes/eui_theme_dark.45c087c0a7ccec8a2229.min.css" data-name="eui-theme" data-theme-name="Dark" data-theme="dark" disabled="" aria-disabled="true"/><link rel="stylesheet" href="/detection-rules/themes/eui_theme_light.3de9904404a3ccaf0ed2.min.css" data-name="eui-theme" data-theme-name="Light" data-theme="light"/><meta name="eui-styles-utility"/><link rel="icon" type="image/png" href="/detection-rules/images/favicon/prod/favicon-16x16.png" sizes="16x16"/><link rel="icon" type="image/png" href="/detection-rules/images/favicon/prod/favicon-32x32.png" sizes="32x32"/><link rel="icon" type="image/png" href="/detection-rules/images/favicon/prod/favicon-96x96.png" sizes="96x96"/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/detection-rules/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/detection-rules/_next/static/chunks/webpack-c73afe323da3efce.js" defer=""></script><script src="/detection-rules/_next/static/chunks/framework-79bce4a3a540b080.js" defer=""></script><script src="/detection-rules/_next/static/chunks/main-5102c8e4b2124298.js" defer=""></script><script src="/detection-rules/_next/static/chunks/pages/_app-8ab1ee1d2225c257.js" defer=""></script><script src="/detection-rules/_next/static/chunks/4739-fe04f91fe87b4ae9.js" defer=""></script><script src="/detection-rules/_next/static/chunks/1443-2d78955dcc9763a8.js" defer=""></script><script src="/detection-rules/_next/static/chunks/5530-5e22f416f76dca97.js" defer=""></script><script src="/detection-rules/_next/static/chunks/pages/rules/%5Bid%5D-6982d34a9e84e27e.js" defer=""></script><script src="/detection-rules/_next/static/8yV7yIoPLgynoP5w4wete/_buildManifest.js" defer=""></script><script src="/detection-rules/_next/static/8yV7yIoPLgynoP5w4wete/_ssgManifest.js" defer=""></script></head><body class="guideBody"><div id="__next" data-reactroot=""><style data-emotion="css-global nb305a">#__next,.guideBody{min-height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:100%;}</style><div class="euiHeader euiHeader--default euiHeader--fixed"><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><a href="/detection-rules" class="eui-jxpcya"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-7yvbl4-euiIcon-l" role="img" aria-hidden="true"></svg><span class="euiTitle eui-z21xof-euiTitle-xxs">Elastic Security Detection Rules</span></a></div></div><div class="euiHeaderSection euiHeaderSection--dontGrow euiHeaderSection--left"><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><button class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" type="button" aria-label="Change theme"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-4394ro-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></button></span></div><div class="euiHeaderSectionItem"><span class="euiToolTipAnchor eui-jcaat8-euiToolTipAnchor-inlineBlock"><a class="euiButtonEmpty euiHeaderSectionItemButton eui-wvaqcf-empty-text" href="https://github.com/elastic/detection-rules" rel="noreferrer" aria-label="EUI GitHub repo"><span class="euiButtonContent euiButtonEmpty__content"><span class="euiButtonEmpty__text"><span class="euiHeaderSectionItemButton__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-2txxin-euiIcon-m" role="img" aria-hidden="true"></svg></span></span></span></a></span></div></div></div><div class="eui-gok634"><div class="eui-1kqz3nm"><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Privileges Elevation via Parent Process PID Spoofing</h1><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Last updated <!-- -->a month ago<!-- --> on<!-- --> <!-- -->2023-06-22</div><div class="euiText eui-x1zygz-euiText-s-euiTextColor-subdued">Created <!-- -->9 months ago<!-- --> on<!-- --> <!-- -->2022-10-20</div></div></div></div><div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive eui-lw6o6k"><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">About</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><div class="euiText eui-1yivsv3-euiText-m">Identifies parent process spoofing used to create an elevated child process. Adversaries may spoof the parent process
identifier (PPID) of a new process to evade process-monitoring defenses or to elevate privileges.
</div><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Tags</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#ee789d;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Domain: Endpoint</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#6dccb1;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">OS: Windows</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#79aad9;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Use Case: Threat Detection</span></span></span><span class="euiBadge eui-n49zn7-euiBadge" style="background-color:#f1d86f;color:#000"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon euiBadge__icon eui-1uiqggp-euiIcon-s-inherit-euiBadge__icon-left" role="img" aria-hidden="true"></svg><span class="euiBadge__text eui-1vg55k4-euiBadge__text">Tactic: Privilege Escalation</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Severity</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><div class="euiHealth eui-qn8ayk-euiHealth-s"><div class="euiFlexGroup euiFlexGroup--gutterExtraSmall euiFlexGroup--alignItemsCenter euiFlexGroup--directionRow"><div class="euiFlexItem euiFlexItem--flexGrowZero"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-h17o4q-euiIcon-m-danger" role="img" aria-hidden="true"></svg></div><div class="euiFlexItem euiFlexItem--flexGrowZero">high</div></div></div></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Risk Score</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">73</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">MITRE ATT&amp;CK™</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/tactics/TA0004/" target="_blank" rel="noopener noreferrer">Privilege Escalation<!-- --> (<!-- -->TA0004<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a><div class="euiText eui-14lwe4a-euiText-xs"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://attack.mitre.org/techniques/T1134/" target="_blank" rel="noopener noreferrer">↳ <!-- -->Access Token Manipulation<!-- --> (<!-- -->T1134<!-- -->)<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></div><div class="euiSpacer euiSpacer--xs eui-1wffcmx-euiSpacer-xs"></div></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">License</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://www.elastic.co/licensing/elastic-license" target="_blank" rel="noopener">Elastic License v2<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></dd></dl></div></div><div class="euiFlexItem"><div class="euiPanel euiPanel--plain euiPanel--paddingMedium eui-1yzwxdg-euiPanel-grow-m-m-plain-hasShadow"><h1 class="euiTitle eui-smz32e-euiTitle-m">Definition</h1><div class="euiSpacer euiSpacer--l eui-p2o3x6-euiSpacer-l"></div><dl class="euiDescriptionList eui-12pc6e7-euiDescriptionList-column-left" data-type="column"><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Rule Type</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Event Correlation Rule</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Integration Pack</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m">Prebuilt Security Detection Rules</dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Index Patterns</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><span class="euiBadge eui-1yifmy7-euiBadge-hollow"><span class="euiBadge__content eui-1yj2yi7-euiBadge__content"><span class="euiBadge__text eui-1vg55k4-euiBadge__text">logs-endpoint.events.*</span></span></span></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Related Integrations</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"><p><a class="euiLink eui-zxmf4e-euiLink-primary" href="https://docs.elastic.co/en/integrations/endpoint" target="_blank" rel="noopener">endpoint<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a></p></dd><dt class="euiDescriptionList__title eui-nd7d6t-euiDescriptionList__title-column-m-normal">Query</dt><dd class="euiDescriptionList__description eui-k4vc05-euiDescriptionList__description-column-normal-m"></dd></dl><div class="euiSpacer euiSpacer--m eui-jv9za2-euiSpacer-m"></div><div class="euiCodeBlock euiCodeBlock--fontSmall euiCodeBlock--paddingLarge"><pre class="euiCodeBlock__pre euiCodeBlock__pre--whiteSpacePreWrap" tabindex="-1"><code class="euiCodeBlock__code" data-code-language="text"><span class="euiCodeBlock__line">/* This rule is compatible with Elastic Endpoint only */
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line">process where host.os.type == &quot;windows&quot; and event.action == &quot;start&quot; and
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"> /* process creation via seclogon */
</span><span class="euiCodeBlock__line"> process.parent.Ext.real.pid &gt; 0 and
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"> /* PrivEsc to SYSTEM */
</span><span class="euiCodeBlock__line"> user.id : &quot;S-1-5-18&quot;  and
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"> /* Common FPs - evasion via hollowing is possible, should be covered by code injection */
</span><span class="euiCodeBlock__line"> not process.executable : (&quot;?:\\Windows\\System32\\WerFault.exe&quot;,
</span><span class="euiCodeBlock__line">                           &quot;?:\\Windows\\SysWOW64\\WerFault.exe&quot;,
</span><span class="euiCodeBlock__line">                           &quot;?:\\Windows\\System32\\WerFaultSecure.exe&quot;,
</span><span class="euiCodeBlock__line">                           &quot;?:\\Windows\\SysWOW64\\WerFaultSecure.exe&quot;,
</span><span class="euiCodeBlock__line">                           &quot;?:\\Windows\\System32\\Wermgr.exe&quot;,
</span><span class="euiCodeBlock__line">                           &quot;?:\\Windows\\SysWOW64\\Wermgr.exe&quot;,
</span><span class="euiCodeBlock__line">                           &quot;?:\\Windows\\SoftwareDistribution\\Download\\Install\\securityhealthsetup.exe&quot;) and
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"> not process.parent.executable : &quot;?:\\Windows\\System32\\AtBroker.exe&quot; and
</span><span class="euiCodeBlock__line">
</span><span class="euiCodeBlock__line"> not (process.code_signature.subject_name in
</span><span class="euiCodeBlock__line">           (&quot;philandro Software GmbH&quot;, &quot;Freedom Scientific Inc.&quot;, &quot;TeamViewer Germany GmbH&quot;, &quot;Projector.is, Inc.&quot;,
</span><span class="euiCodeBlock__line">            &quot;TeamViewer GmbH&quot;, &quot;Cisco WebEx LLC&quot;, &quot;Dell Inc&quot;) and process.code_signature.trusted == true)
</span><span class="euiCodeBlock__line"></span></code></pre></div></div></div></div><div class="euiPanel euiPanel--primary euiPanel--paddingMedium euiCallOut euiCallOut--primary eui-1htmxq-euiPanel-none-m-primary-euiCallOut"><p class="euiTitle euiCallOutHeader__title eui-akxjbi-euiTitle-xs-euiCallOutHeader-primary"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-vlvl53-euiIcon-m-inherit-euiCallOut__icon" role="img" aria-hidden="true"></svg>Install detection rules in Elastic Security</p><div class="euiText eui-1hexw8x-euiText-s-euiTextColor-default-euiCallOut__description"><div class="euiSpacer euiSpacer--s eui-78drzl-euiSpacer-s"></div><p>Detect <!-- -->Privileges Elevation via Parent Process PID Spoofing<!-- --> in the Elastic Security detection engine by installing this rule into your Elastic Stack.</p><p>To setup this rule, check out the installation guide for<!-- --> <a class="euiLink eui-zxmf4e-euiLink-primary" href="https://docs.elastic.co/en/integrations/security_detection_engine" target="_blank" rel="noopener">Prebuilt Security Detection Rules<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" class="euiIcon eui-1ed6zfh-euiIcon-s-euiLink__externalIcon" role="img" aria-label="External link" aria-hidden="true"></svg><span class="eui-194jjcc-euiScreenReaderOnly-euiLink__screenReaderText">(opens in a new tab or window)</span></a>.</p></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"rule":{"metadata":{"creation_date":"2022/10/20","integration":["endpoint"],"maturity":"production","min_stack_comments":"New fields added: required_fields, related_integrations, setup","min_stack_version":"8.3.0","updated_date":"2023/06/22"},"rule":{"author":["Elastic"],"description":"Identifies parent process spoofing used to create an elevated child process. Adversaries may spoof the parent process\nidentifier (PPID) of a new process to evade process-monitoring defenses or to elevate privileges.\n","from":"now-9m","index":["logs-endpoint.events.*"],"language":"eql","license":"Elastic License v2","name":"Privileges Elevation via Parent Process PID Spoofing","references":["https://gist.github.com/xpn/a057a26ec81e736518ee50848b9c2cd6","https://blog.didierstevens.com/2017/03/20/","https://learn.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-updateprocthreadattribute","https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1134.002/T1134.002.md"],"risk_score":73,"rule_id":"26b01043-4f04-4d2f-882a-5a1d2e95751b","severity":"high","tags":["Domain: Endpoint","OS: Windows","Use Case: Threat Detection","Tactic: Privilege Escalation"],"timestamp_override":"event.ingested","type":"eql","query":"/* This rule is compatible with Elastic Endpoint only */\n\nprocess where host.os.type == \"windows\" and event.action == \"start\" and\n\n /* process creation via seclogon */\n process.parent.Ext.real.pid \u003e 0 and\n\n /* PrivEsc to SYSTEM */\n user.id : \"S-1-5-18\"  and\n\n /* Common FPs - evasion via hollowing is possible, should be covered by code injection */\n not process.executable : (\"?:\\\\Windows\\\\System32\\\\WerFault.exe\",\n                           \"?:\\\\Windows\\\\SysWOW64\\\\WerFault.exe\",\n                           \"?:\\\\Windows\\\\System32\\\\WerFaultSecure.exe\",\n                           \"?:\\\\Windows\\\\SysWOW64\\\\WerFaultSecure.exe\",\n                           \"?:\\\\Windows\\\\System32\\\\Wermgr.exe\",\n                           \"?:\\\\Windows\\\\SysWOW64\\\\Wermgr.exe\",\n                           \"?:\\\\Windows\\\\SoftwareDistribution\\\\Download\\\\Install\\\\securityhealthsetup.exe\") and\n\n not process.parent.executable : \"?:\\\\Windows\\\\System32\\\\AtBroker.exe\" and\n\n not (process.code_signature.subject_name in\n           (\"philandro Software GmbH\", \"Freedom Scientific Inc.\", \"TeamViewer Germany GmbH\", \"Projector.is, Inc.\",\n            \"TeamViewer GmbH\", \"Cisco WebEx LLC\", \"Dell Inc\") and process.code_signature.trusted == true)\n","threat":[{"framework":"MITRE ATT\u0026CK","technique":[{"id":"T1134","name":"Access Token Manipulation","reference":"https://attack.mitre.org/techniques/T1134/","subtechnique":[{"id":"T1134.002","name":"Create Process with Token","reference":"https://attack.mitre.org/techniques/T1134/002/"},{"id":"T1134.004","name":"Parent PID Spoofing","reference":"https://attack.mitre.org/techniques/T1134/004/"}]}],"tactic":{"id":"TA0004","name":"Privilege Escalation","reference":"https://attack.mitre.org/tactics/TA0004/"}}]}}},"__N_SSG":true},"page":"/rules/[id]","query":{"id":"26b01043-4f04-4d2f-882a-5a1d2e95751b"},"buildId":"8yV7yIoPLgynoP5w4wete","assetPrefix":"/detection-rules","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>